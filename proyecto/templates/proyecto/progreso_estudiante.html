{%  extends 'proyecto/main.html' %}
{% block content %}            
{% if mensajes_avisos %}
  {% for aviso in mensajes_avisos %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      <strong>¡Noticias!</strong>
      Se realizó la siguiente actividad: <strong>{{aviso|title}}</strong>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}
{% if grupo == 'director'%}
  <div class="d-flex flex-row-reverse bd-highlight">
      <a href={% url "tiempos:resumen" equipo.id %}>Información tiempo</a>
  </div>
{% endif %}

{% if equipo.cantidad > 1%}
  <div class="d-flex flex-row-reverse bd-highlight">
      <a class="btn btn-primary" href={% url "modalidad:ver_equipo" estudiante.equipo.pk %}>Ver Equipo</a>
  </div>
  <div class="d-flex justify-content-evenly">
    <h3><strong>MODALIDAD: {{estudiante.get_modalidad_display|upper}}</strong></h3>
  </div>
{% else %}
  <h4 class='text-center'><strong>ESTUDIANTE: {{estudiante|upper}}</strong></h4>
{% endif %}

{% if estudiante.modalidad == "multiple" and estudiante.equipo.cantidad == 1%}
  <div class="d-grid gap-2 col-6 mx-auto">
    <a class="btn btn-danger btn-lg" href={% url 'modalidad:ver_solicitud' estudiante.solicitud_set.last.pk %}>Responder a Solicitud de Modalidad Múltiple</a>
  </div>
  <br>
{% endif %}

{% if not equipo.tribunales.count == 2 and grupo != 'director' %}
  {% if grupo == 'docente' and sala_doc.tipo == 'proyecto' and sala_doc.salarevisarapp_set.count >= 1 %}
    {% include 'revisar_documentos/calificar.html'%}
    {% comment %}{% include 'revisar_documentos/vista_revisor_docente_proyecto.html'%}{% endcomment %}
    <div class="d-grid gap-2 col-6 mx-auto">
      <a class="btn btn-primary btn-lg" href={% url 'revisar_documentos:revisar_documento_revisor' sala_doc.tipo equipo.id %}>Revisión de Proyecto de Grado</a>
      <br>
    </div>
  {% else %}
    {% include 'revisar_documentos/vista_revisor.html'%}
  {% endif %}
{% endif %}

{% if grupo == 'tribunal'%}
  {% include 'revisar_documentos/vista_revisor.html'%}
{% endif %}

{% comment %}***** solicitar y ver tribunal *****{% endcomment %}
{%if grupo == 'docente' and not equipo.solicitud_tribunal_docente and equipo.proyectodegrado and calificacion != None%}
  <a class="btn btn-danger" href={% url 'solicitar_tribunal_docente' equipo.id %}>Solicitar Tribunal a Jefatura de Carrera</a><br><br>
{% elif grupo == 'docente' or grupo == 'tutor' %}
  {% if equipo.solicitud_tribunal_docente and equipo.tribunales.count < 2%}
    {% comment %}<div class="d-inline p-2 bg-primary text-white">{% endcomment %}
    <div class="alert alert-primary" role="alert">
      Se solicitó tribunales a jefatura de carrera
    </div>
  {% elif equipo.tribunales.count == 2 %}
    {% include 'proyecto/lista_tribunal_asignado.html'%}
  {% endif %}
{% elif grupo == 'director' and equipo.solicitud_tribunal_docente and equipo.tribunales.count < 2%}
  <p>
  <div class="d-inline p-2 bg-danger text-white">El docente ETN 1040 Ing. 
    {{equipo.docente}}, solicitó tribunales para 
    {% if equipo.cantidad > 1 %}
      el equipo:
      {{equipo.alias}}</div>
    {% else %}
      el estudiante:
      {{estudiante}}</div>
    {% endif %}
  <a class="btn btn-warning" href={% url 'asignar_tribunal' equipo.id %}>Asignar Tribunal</a>
  </p>
{% elif grupo == 'director' or grupo == 'tutor' %}
  {% if equipo.tribunales.count == 2 %}
    {% include 'proyecto/lista_tribunal_asignado.html'%}
  {% endif %}
{%endif%}

<div class="row">
  <div class="col-md-7">
    {% comment %}***** aviso no se puso la nota{% endcomment %}
    {%if grupo != 'tribunal' and not equipo.registroproyectotribunal.nota and equipo.registroproyectotribunal %}
      <h5 class='text-center'>El Tribunal aún no puso la nota</h5>
      <h5 class='text-center'>Se espera la defensa de Proyecto de Grado</h5>
    {%endif%}
    {%if grupo == 'tutor' or grupo == 'director' %}
      {% if calificacion == None and not proyecto == None%}
        <h5 class='text-center'>El docente aún no puso la nota</h5>
        <h5 class='text-center'>Pero el estudiante ya registró el Proyecto de Grado </h5>
      {% endif %}
    {%endif%}
    {% comment %}Calificacion{% endcomment %}
    {% comment %}{%if grupo == 'docente' and calificacion == None and not proyecto == None%}{% endcomment %}

    {%if grupo == 'docente' and estudiante.equipo.proyectodegrado.calificacion and equipo.tribunales.count <= 1 %}
      <a class="btn btn-danger" href={% url 'calificar_proyecto' estudiante.id %}>Calificar Proyecto</a>
    {%endif%}

    {% if grupo == 'tribunal' and equipo.registroproyectotribunal and not is_nota_tribunal %}
      <a class="btn btn-danger" href={% url 'calificar_proyecto_tribunal' equipo.id %}>Calificar Proyecto Final</a><br><br>
    {% endif %}

    {% comment %}****** ver nota ******{% endcomment %}
    {%if grupo == 'docente' or grupo == 'director' %}
      {%if calificacion != None %}
        {% include 'proyecto/ver_nota.html' %}
      {%endif%}
    {%endif%}

    {%if grupo == 'tribunal' and not calificacion == None %}
    {% include 'proyecto/ver_nota.html' %}
    {% endif %}
    {%if grupo == 'tutor' and not calificacion == None%}
    {% include 'proyecto/ver_nota.html' %}
    {%endif%}
    {% comment %}******** visto bueno ********{% endcomment %}
    <p>
    {% for sala_doc_est in salas_doc_est %}
    {% if sala_doc_est.visto_bueno %}
    <p><div class="d-inline p-2 bg-success text-white">
      El {{sala_doc_est.grupo_revisor|title}} ya dio visto bueno al {{sala_doc_est.tipo|title}}</div></p>
    {% else %}
    <p><div class="d-inline p-2 bg-danger text-white">
      El {{sala_doc_est.grupo_revisor|title}} aún no dio el visto bueno al {{sala_doc_est.tipo|title}}</div></p>
    {% endif %}
    {% endfor %}
    </p>

  {% comment %}[>***** barras del cronograma *****<]{% endcomment %}
  {% include 'proyecto/cronograma_info.html'%}

  {% comment %}***** boton ver cronograma *****{% endcomment %}
  {% if estudiante.equipo.registrocronograma %}
    <a class="btn btn-warning" href={% url 'ver_cronograma' estudiante.equipo.id %}>Cronograma</a>
  {% else %}
    <a class="btn btn-warning disabled" href=#>Cronograma</a>
  {% endif %}

  <br><br><a class="btn btn-danger" href='/'> Atras</a>

  </div>

  <div class="col-md-5">
    {% comment %}***** progreso ******{% endcomment %}
    <h5>Progreso del estudiante</h5>
    <div class="progress">
      <div class="progress-bar" role="progressbar" style="width: {{progreso}}%;"
      aria-valuenow="{{progreso}}" aria-valuemin="0" aria-valuemax="100">
      {{progreso}}%
      </div>
    </div>
    <br>
    {% comment %}{% include 'proyecto/documentos_estudiante.html'%}{% endcomment %}
    {% include 'documentos/documentos_estudiante.html'%}
  </div>
</div>

{% endblock %}

