{%  extends 'proyecto/main.html' %}
{% block content %}            

<h5>Progreso del estudiante: {{estudiante}}</h5>
<div class="progress">
    <div class="progress-bar" role="progressbar" style="width: {{progreso}}%;"
        aria-valuenow="{{progreso}}" aria-valuemin="0" aria-valuemax="100">
        {{progreso}}%
    </div>
</div>
<br>
{% include 'proyecto/cronograma_info.html'%}
{% if estudiante.registrocronograma %}
    <a class="btn btn-warning" href={% url 'ver_cronograma' estudiante.id %}>Cronograma</a>
{% else %}
    <a class="btn btn-warning disabled" href=#>Cronograma</a>
{% endif %}

{%if grupo == 'docente' and calificacion == None and not proyecto == None%}
    <a class="btn btn-success" href={% url 'calificar_proyecto' estudiante.id %}>Calificar Proyecto</a>
{%endif%}
{%if grupo == 'docente' and not estudiante.solicitud_tribunal_docente and estudiante.proyectodegrado and calificacion != None%}
    <a class="btn btn-danger" href={% url 'solicitar_tribunal_docente' estudiante.id %}>Solicitar Tribunal</a>
{% elif grupo == 'docente' and estudiante.solicitud_tribunal_docente and estudiante.tribunales.count < 2%}
    <div class="d-inline p-2 bg-primary text-white">Se solicitó tribunales a jefatura</div>
{% elif grupo == 'docente' and estudiante.tribunales.count == 2%}
    <div class="d-inline p-2 bg-success text-white">Tribunal asignado</div><br>
    <a href={% url 'enlace_tribunal' estudiante.tribunales.all.0.id %}>{{estudiante.tribunales.all.0}}</a><br>
    <a href={% url 'enlace_tribunal' estudiante.tribunales.all.1.id %}>{{estudiante.tribunales.all.1}}</a><br>
{% elif grupo == 'director' and estudiante.solicitud_tribunal_docente and estudiante.tribunales.count < 2%}
<p>
<div class="d-inline p-2 bg-danger text-white">El docente ETN 1040 Ing. 
    {{estudiante.grupo_doc}} solicito tribunales para el estudiante:
    {{estudiante}}</div>
<a class="btn btn-warning" href={% url 'asignar_tribunal' estudiante.id %}>Asignar Tribunal</a>
</p>
{% elif grupo == 'director' or grupo == 'tutor' %}
    {% if estudiante.tribunales.count == 2%}
        <div class="d-inline p-2 bg-success text-white">Tribunal asignado</div><br>
        <a href={% url 'enlace_tribunal' estudiante.tribunales.all.0.id %}>{{estudiante.tribunales.all.0}}</a><br>
        <a href={% url 'enlace_tribunal' estudiante.tribunales.all.1.id %}>{{estudiante.tribunales.all.1}}</a><br>
    {% endif %}
{%endif%}
{%if grupo == 'docente' or grupo == 'director' %}
{%if calificacion != None %}
<p>
<strong>Calificación del Proyecto de Grado</strong><br>
Tiempo Elaboración (Max. 9%): <strong>{{proyecto.nota_tiempo_elaboracion}}</strong><br>
Exposiciones/Seminarios (Max. 6%): <strong>{{proyecto.nota_expos_seminarios}}</strong><br>
Informes de Trabajos (Max. 22%): <strong>{{proyecto.nota_informes_trabajo}}</strong><br>
Cumplimiento de Cronograma (Max. 3%): <strong>{{proyecto.nota_cumplimiento_cronograma}}</strong><br>
Total Calificación (Max. 40%): <strong>{{proyecto.calificacion}}</strong><br>
</p>
{% comment %}<h5 class='text-center'>La calificacion del Proyecto de Grado es: </h5>{% endcomment %}
{% comment %}<h3 class="text-center">* {{calificacion}} *</h3>{% endcomment %}
{%endif%}
{%endif%}
{%if grupo == 'tutor' and not calificacion == None%}
<p>
<strong>Calificación del Proyecto de Grado</strong><br>
Tiempo Elaboración (Max. 9%): <strong>{{proyecto.nota_tiempo_elaboracion}}</strong><br>
Exposiciones/Seminarios (Max. 6%): <strong>{{proyecto.nota_expos_seminarios}}</strong><br>
Informes de Trabajos (Max. 22%): <strong>{{proyecto.nota_informes_trabajo}}</strong><br>
Cumplimiento de Cronograma (Max. 3%): <strong>{{proyecto.nota_cumplimiento_cronograma}}</strong><br>
Total Calificación (Max. 40%): <strong>{{proyecto.calificacion}}</strong><br>
</p>
{% comment %}<h5 class='text-center'>La calificacion del Proyecto de Grado es: </h5>{% endcomment %}
{% comment %}<h3 class="text-center">* {{calificacion}} *</h3>{% endcomment %}
{%endif%}
{%if grupo == 'tutor' and calificacion == None and not proyecto == None%}
<h5 class='text-center'>El docente aún no puso la nota</h5>
<h5 class='text-center'>Pero el estudiante ya registró el Proyecto de Grado </h5>
{%endif%}
{% comment %}******** visto bueno ********{% endcomment %}
<p>
{% if grupo == 'docente' %}
    {% if progreso < 64 %}
        {% if estudiante.vb_perfil_tutor%}
            <div class="d-inline p-2 bg-success text-white">El Tutor ya dio el visto bueno al perfil</div>
        {% else %}
            <div class="d-inline p-2 bg-danger text-white">El Tutor aún no dio el visto bueno al perfil</div>
        {% endif %}
    {% else %}
        {% if estudiante.vb_proyecto_tutor%}
            <div class="d-inline p-2 bg-success text-white">El Tutor ya dio el visto bueno al proyecto de grado</div>
        {% else %}
            <div class="d-inline p-2 bg-danger text-white">El Tutor aún no dio el visto bueno al proyecto de grado</div>
        {% endif %}
    {% endif %}
{% endif %}
</p>




<div class="row">
    <div class="col-md-7">
{% if grupo == 'tribunal'%}
    {% include 'proyecto/revisar_tribunal.html' %}
{% endif %}
{% comment %}********* PROYECTO DE GRADO **************{% endcomment %}
{% if progreso >= 64 and progreso <= 86 and not grupo == 'director'%}
    <h4 class='text-center'><strong>REVISIÓN DE PROYECTO DE GRADO</strong></h4>
    <div class = 'border border-4 
{% if progreso >= 64%}
    border-success
{% else %}
    border-secondary
{% endif %}
    '>
<table class="table table-striped table-hover ">
  <thead>
    <tr>
      <th scope="col">Asunto</th>
      <th scope="col">Detalles</th>
      {% comment %}<th scope="col">Proyecto{% endcomment %}
      <th scope="col">
        {% if grupo == 'docente'%}
        {% if estudiante.vb_proyecto_docente%}
        <div class="d-inline p-2 bg-success text-white">Visto Bueno OK</div>
        {% else %}
            {% if salas_proy and estudiante.vb_proyecto_tutor %}
                <a href="{% url 'visto_bueno_proyecto' estudiante.id %}" type="button" class="btn btn-outline-danger btn-sm" 
                data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                Dar Visto Bueno</a>
            {% else %}
                <a href=# type="button" class="btn btn-outline-danger btn-sm disabled" 
                data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                Dar Visto Bueno</a>
            {% endif %}
        {% endif %}
        {% endif %}
        {% if grupo == 'tutor'%}
        {% if estudiante.vb_proyecto_tutor%}
        <div class="d-inline p-2 bg-success text-white">Visto Bueno OK</div>
        {% else %}
            {% if salas_proy %}
                <a href="{% url 'visto_bueno_proyecto' estudiante.id %}" type="button" class="btn btn-outline-danger btn-sm" 
                data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                Dar Visto Bueno</a>
            {% else %}
            <a href=# type="button" class="btn btn-outline-danger btn-sm disabled"> 
                Dar Visto Bueno</a>
            {% endif %}
        {% endif %}
        {% endif %}
      </th>
      {% if grupo == 'tutor' %}
        <th scope="col">Revisar</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
{%for s, no_visto in dicc_salas_proy.items%}
    <tr>
<td>
{{s.sala}}
</td>      

<td>
<p>
  <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
      Detalles
  </button>
</p>
<div class="collapse" id="collapseExample">
  <div class="card card-body">
      {{s.texto}}
  </div>
</div>
</td>      

<td>
    <a class="btn btn-primary" href="{{ s.material_estudiante.url }}">Proyecto</a>
</td>
<td>
{% if grupo == 'tutor' %}
    {% if no_visto == 0%}
    <a class="btn btn-primary position-relative" href="{% url 'sala_revisar_proyecto' s.id %}">Observación</a>
    {% else %}
    <a href="{% url 'sala_revisar_proyecto' s.id %}" type="button" class="btn btn-primary position-relative">
        Observación
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{no_visto}}
        <span class="visually-hidden">unread messages</span>
    </span>
    </a>
    {% endif %}
    {% comment %}<a class="btn btn-primary" href="{% url 'proyecto_corregido' s.id %}">Corrección</a>{% endcomment %}
{% endif %}
</td>      

    </tr>
{%endfor%}
  </tbody>
</table>
</div>
<br>

{% endif %}


{% comment %}********* PERFIL **************{% endcomment %}
{% if progreso < 64 and not grupo == 'director'%}
    <h4 class='text-center'><strong>REVISIÓN DE PERFIL</strong></h4>
    <div class = 'border border-4 
    {% if progreso >= 64%}
        border-seccondary
    {% else %}
        border-success
    {% endif %}
        '>
<table class="table table-striped table-hover ">
  <thead>
    <tr>
      <th scope="col">Asunto</th>
      <th scope="col">Detalles</th>
      <th scope="col">
        {% if grupo == 'docente'%}
            {% if estudiante.vb_perfil_docente%}
            <div class="d-inline p-2 bg-success text-white">Visto Bueno OK</div>
            {% else %}
                {% if salas.exists and estudiante.vb_perfil_tutor%}
                    <a href="{% url 'visto_bueno_perfil' estudiante.id %}" type="button" class="btn btn-outline-danger btn-sm" 
                    data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                    Dar Visto Bueno</a>
                {% else %}
                    <a href=# type="button" class="btn btn-outline-danger btn-sm disabled" 
                    data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                    Dar Visto Bueno</a>
                {% endif %}
            {% endif %}
        {% endif %}

        {% if grupo == 'tutor'%}
        {% if estudiante.vb_perfil_tutor%}
        <div class="d-inline p-2 bg-success text-white" 
        data-bs-toggle="tooltip" data-bs-placement="right" title="Visto Bueno OK">
        Visto Bueno OK</div>
        {% else %}
            {% if salas %}
                <a href="{% url 'visto_bueno_perfil' estudiante.id %}" type="button" class="btn btn-outline-danger btn-sm" 
                data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                Dar Visto Bueno</a>
            {% else %}
                <a href=# type="button" class="btn btn-outline-danger btn-sm disabled" 
                data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                Dar Visto Bueno</a>
            {% endif %}
        {% endif %}
        {% endif %}
        {% comment %}<a href=# type="button" class="btn badge rounded-pill bg-secondary" {% endcomment %}
        {% comment %}data-bs-toggle="tooltip" data-bs-placement="right" title="Visto Bueno">{% endcomment %}
        {% comment %}V.B.</a>{% endcomment %}
      </th>
      {% if grupo == 'tutor' %}
        <th scope="col">Revisar</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
{%for s,no_visto in dicc_salas.items%}
    <tr>
<td>
    <p>{{s.sala}}</p>
</td>      

<td>
<p>
  <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
      Detalles
  </button>
</p>
<div class="collapse" id="collapseExample">
  <div class="card card-body">
      {{s.texto}}
  </div>
</div>
</td>      

<td>
    <a class="btn btn-primary" href="{{ s.material_estudiante.url }}">Perfil</a>
</td>
<td>
{% if grupo == 'tutor' %}
    {% if no_visto == 0%}
    <a class="btn btn-primary position-relative" href="{% url 'sala_revisar' s.id %}">Observación</a>
    {% else %}
    <a href="{% url 'sala_revisar' s.id %}" type="button" class="btn btn-primary position-relative">
        Observación
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{no_visto}}
        <span class="visually-hidden">unread messages</span>
    </span>
    </a>
    {% endif %}
    {% comment %}<a class="btn btn-primary" href="{% url 'perfil_corregido' s.id %}">Corrección</a>{% endcomment %}
{% endif %}

</td>      

    </tr>
{%endfor%}
  </tbody>
</table>
</div>
<br>



{% endif %}

    </div>
    <div class="col-md-5">
		<h5>Documentos del estudiante:</h5>
		<div class="card card-body">
            <table class="table table-sm table-striped">
            <thead>
                <tr>
                <th scope="col">Documento</th>
                <th scope="col">Estado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    {% if estudiante.tutor_acepto%}
                    <td class='bg-success text-white'>
                        <a target='_blank' href={%url 'reporte_tutor_acepto' estudiante.id%} 
                            class='text-white text-underline-hover'>
                            Carta de Aceptación Tutoría</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Carta de Aceptación Tutoría</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
                <tr>
                    {% if estudiante.registroperfil %}
                    <td class='bg-success text-white'>
                        <a target='_blank' href="{{ estudiante.registroperfil.perfil.url }}" 
                            class='text-white text-underline-hover'>
                            Perfil de Proyecto de Grado</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Perfil de Proyecto de Grado</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                <tr>
                    {% if estudiante.registrocronograma %}
                    <td class='bg-success text-white'>
                        <a target='_blank' href={%url 'formulario_1' estudiante.id%}
                            class='text-white text-underline-hover'>
                            Formulario 1<br>Aprobación Perfil</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Formulario 1<br>Aprobación Perfil</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
                <tr>
                    {% if estudiante.proyectodegrado%}
                    <td class='bg-success text-white'>
                        <a target='_blank' href="{{ estudiante.proyectodegrado.archivo.url }}"
                            class='text-white text-underline-hover'>
                            Proyecto de Grado</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Proyecto de Grado</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
                <tr>
                    {% if estudiante.proyectodegrado.calificacion %}
                    <td class='bg-success text-white'>
                        <a target='_blank' href={%url 'carta_final' estudiante.id %} class='text-white text-underline-hover'>
                            Carta de Conclusión</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Carta de Conclusión</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
                <tr>
                    {% if estudiante.proyectodegrado.calificacion%}
                    <td class='bg-success text-white'>
                        <a target='_blank' href={%url 'formulario_2' estudiante.id %} class='text-white text-underline-hover'>
                            Formulario 2<br>Materia: Proyecto</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Formulario 2<br>Materia: Proyecto</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
                <tr>
                    {% if estudiante.proyectodegrado.calificacion%}
                    <td class='bg-success text-white'>
                        <a target='_blank' href={%url 'formulario_3' estudiante.id %} class='text-white text-underline-hover'>
                            Formulario 3<br>Registro y Seguimiento</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Formulario 3<br>Registro y Seguimiento</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
                <tr>
                    {% if estudiante.proyectodegrado.calificacion %}
                    <td class='bg-success text-white'>
                        <a target='_blank' href={%url 'formulario_4' estudiante.id %} class='text-white text-underline-hover'>
                            Formulario 4<br>Solicitud Nombramiento Tribunal</a></td>
                    <td class='bg-success text-white'><i class="fas fa-check"></i></td>
                    {% else %}
                    <td class='bg-danger text-white'>Formulario 4<br>Solicitud Nombramiento Tribunal</td>
                    <td class='bg-danger text-white'><i class="fas fa-times"></i></td>
                    {% endif %}
                </tr>
            </tbody>
            </table>
        </div>
    </div>
</div>



<a class="btn btn-danger" href='/'> Atras</a>

<br>
{% endblock %}

