{%  extends 'proyecto/main.html' %}
{% block content %}            

<h5>Progreso del estudiante: {{estudiante}}</h5>
<div class="progress">
    <div class="progress-bar" role="progressbar" style="width: {{progreso}}%;"
        aria-valuenow="{{progreso}}" aria-valuemin="0" aria-valuemax="100">
        {{progreso}}%
    </div>
</div>
<br>
{% include 'proyecto/cronograma_info.html'%}

{% if estudiante.registrocronograma %}
    <a class="btn btn-warning" href={% url 'ver_cronograma' estudiante.id %}>Cronograma</a>
{% else %}
    <a class="btn btn-warning disabled" href=#>Cronograma</a>
{% endif %}

{%if grupo == 'docente' and calificacion == None and not proyecto == None%}
    <a class="btn btn-danger" href={% url 'calificar_proyecto' estudiante.id %}>Calificar Proyecto</a>
{%endif%}

{%if grupo == 'docente' and not estudiante.solicitud_tribunal_docente and estudiante.proyectodegrado and calificacion != None%}
    <a class="btn btn-danger" href={% url 'solicitar_tribunal_docente' estudiante.id %}>Solicitar Tribunal</a>
{% elif grupo == 'docente' or grupo == 'tutor' or grupo == 'director'%}
    {% if estudiante.solicitud_tribunal_docente and estudiante.tribunales.count < 2%}
        <div class="d-inline p-2 bg-primary text-white">Se solicitó tribunales a jefatura</div>
    {% elif estudiante.tribunales.count == 2%}
        {% include 'proyecto/lista_tribunal_asignado.html'%}
    {% endif %}
{% elif grupo == 'docente' and estudiante.tribunales.count == 2%}
    <div class="d-inline p-2 bg-success text-white">Tribunal asignado</div><br>
    <a href={% url 'enlace_tribunal' estudiante.tribunales.all.0.id %}>{{estudiante.tribunales.all.0}}</a><br>
    <a href={% url 'enlace_tribunal' estudiante.tribunales.all.1.id %}>{{estudiante.tribunales.all.1}}</a><br>
{% elif grupo == 'director' and estudiante.solicitud_tribunal_docente and estudiante.tribunales.count < 2%}
<p>

<div class="d-inline p-2 bg-danger text-white">El docente ETN 1040 Ing. 
    {{estudiante.grupo_doc}} solicito tribunales para el estudiante:
    {{estudiante}}</div>
<a class="btn btn-warning" href={% url 'asignar_tribunal' estudiante.id %}>Asignar Tribunal</a>
</p>
{% elif grupo == 'director' or grupo == 'tutor' %}
    {% if estudiante.tribunales.count == 2%}
        <div class="d-inline p-2 bg-success text-white">Tribunal asignado</div><br>
        <a href={% url 'enlace_tribunal' estudiante.tribunales.all.0.id %}>{{estudiante.tribunales.all.0}}</a><br>
        <a href={% url 'enlace_tribunal' estudiante.tribunales.all.1.id %}>{{estudiante.tribunales.all.1}}</a><br>
    {% endif %}
{%endif%}

{%if grupo == 'docente' or grupo == 'director' %}
    {%if calificacion != None %}
        {% include 'proyecto/ver_nota.html' %}
    {% comment %}<p>{% endcomment %}
    {% comment %}<strong>Calificación del Proyecto de Grado</strong><br>{% endcomment %}
    {% comment %}Tiempo Elaboración (Max. 9%): <strong>{{proyecto.nota_tiempo_elaboracion}}</strong><br>{% endcomment %}
    {% comment %}Exposiciones/Seminarios (Max. 6%): <strong>{{proyecto.nota_expos_seminarios}}</strong><br>{% endcomment %}
    {% comment %}Informes de Trabajos (Max. 22%): <strong>{{proyecto.nota_informes_trabajo}}</strong><br>{% endcomment %}
    {% comment %}Cumplimiento de Cronograma (Max. 3%): <strong>{{proyecto.nota_cumplimiento_cronograma}}</strong><br>{% endcomment %}
    {% comment %}Total Calificación (Max. 40%): <strong>{{proyecto.calificacion}}</strong><br>{% endcomment %}
    {% comment %}</p>{% endcomment %}
    {%endif%}
{%endif%}

{%if grupo == 'tutor' and not calificacion == None%}
        {% include 'proyecto/ver_nota.html' %}
    {% comment %}<p>{% endcomment %}
    {% comment %}<strong>Calificación del Proyecto de Grado</strong><br>{% endcomment %}
    {% comment %}Tiempo Elaboración (Max. 9%): <strong>{{proyecto.nota_tiempo_elaboracion}}</strong><br>{% endcomment %}
    {% comment %}Exposiciones/Seminarios (Max. 6%): <strong>{{proyecto.nota_expos_seminarios}}</strong><br>{% endcomment %}
    {% comment %}Informes de Trabajos (Max. 22%): <strong>{{proyecto.nota_informes_trabajo}}</strong><br>{% endcomment %}
    {% comment %}Cumplimiento de Cronograma (Max. 3%): <strong>{{proyecto.nota_cumplimiento_cronograma}}</strong><br>{% endcomment %}
    {% comment %}Total Calificación (Max. 40%): <strong>{{proyecto.calificacion}}</strong><br>{% endcomment %}
    {% comment %}</p>{% endcomment %}
{%endif%}

{%if grupo == 'tutor' and calificacion == None and not proyecto == None%}
    <h5 class='text-center'>El docente aún no puso la nota</h5>
    <h5 class='text-center'>Pero el estudiante ya registró el Proyecto de Grado </h5>
{%endif%}

{% comment %}******** visto bueno ********{% endcomment %}
<p>
{% if grupo == 'docente' and not estudiante.proyectodegrado %}
    {% if progreso < 64 %}
        {% if estudiante.vb_perfil_tutor%}
            <div class="d-inline p-2 bg-success text-white">El Tutor ya dio visto bueno al perfil</div>
        {% else %}
            <div class="d-inline p-2 bg-danger text-white">El Tutor se encuentra revisando el perfil</div>
        {% endif %}
    {% else %}
        {% if estudiante.vb_proyecto_tutor%}
            <div class="d-inline p-2 bg-success text-white">El Tutor ya dio el visto bueno al proyecto de grado</div>
        {% else %}
            <div class="d-inline p-2 bg-danger text-white">El Tutor aún no dio el visto bueno al proyecto de grado</div>
        {% endif %}
    {% endif %}
{% endif %}
</p>

<div class="row">
    <div class="col-md-7">
        {% include 'revisar/vista_revisor.html'%}
{% comment %}********* PROYECTO TRIBUNAL **************{% endcomment %}
{% if progreso >= 86 and grupo == 'tribunal'%}
    {% if estudiante.registroproyectotribunal and estudiante.registroproyectotribunal.nota %}
        {% include 'proyecto/ver_nota.html' %}
    {% elif estudiante.registroproyectotribunal %}
        <a class="btn btn-danger" href={% url 'calificar_proyecto_tribunal' estudiante.id %}>Calificar Proyecto Final</a>
    {% else %}
        {% include 'proyecto/revisar_tribunal.html' %}
    {% endif %}
{% endif %}

{% comment %}********* PROYECTO DE GRADO **************{% endcomment %}
{% if progreso >= 64 and progreso < 86 and not grupo == 'director' and not estudiante.proyectodegrado %}
    <h4 class='text-center'><strong>REVISIÓN DE PROYECTO DE GRADO</strong></h4>
    <div class = 'border border-4 
    {% if progreso >= 64%}
        border-success
    {% else %}
        border-secondary
    {% endif %}
    '>
    <table class="table table-striped table-hover ">
    <thead>
        <tr>
        <th scope="col">Asunto</th>
        <th scope="col">Detalles</th>
        <th scope="col">
            {% if grupo == 'docente'%}
            {% if estudiante.vb_proyecto_docente%}
            <div class="d-inline p-2 bg-success text-white">Visto Bueno OK</div>
            {% else %}
                {% if salas_proy and estudiante.vb_proyecto_tutor %}
                    <a href="{% url 'visto_bueno_proyecto' estudiante.id %}" type="button" class="btn btn-outline-danger btn-sm" 
                    data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                    Dar Visto Bueno</a>
                {% else %}
                    <a href=# type="button" class="btn btn-outline-danger btn-sm disabled" 
                    data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                    Dar Visto Bueno</a>
                {% endif %}
            {% endif %}
            {% endif %}
            {% if grupo == 'tutor'%}
            {% if estudiante.vb_proyecto_tutor%}
            <div class="d-inline p-2 bg-success text-white">Visto Bueno OK</div>
            {% else %}
                {% if salas_proy %}
                    <a href="{% url 'visto_bueno_proyecto' estudiante.id %}" type="button" class="btn btn-outline-danger btn-sm" 
                    data-bs-toggle="tooltip" data-bs-placement="right" title="Dar Visto Bueno">
                    Dar Visto Bueno</a>
                {% else %}
                <a href=# type="button" class="btn btn-outline-danger btn-sm disabled"> 
                    Dar Visto Bueno</a>
                {% endif %}
            {% endif %}
            {% endif %}
        </th>
        {% if grupo == 'tutor' %}
            <th scope="col">Revisar</th>
        {% endif %}
        </tr>
    </thead>
    <tbody>
        {%for s, no_visto in dicc_salas_proy.items%}
        <tr>
        <td>
        {{s.sala}}
        </td>      
        <td>
        <p>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
            Detalles
        </button>
        </p>
        <div class="collapse" id="collapseExample">
        <div class="card card-body">
            {{s.texto}}
        </div>
        </div>
        </td>      
        <td>
            <a class="btn btn-primary" href="{{ s.material_estudiante.url }}">Proyecto</a>
        </td>

        <td>
        {% if grupo == 'tutor' %}
            {% if no_visto == 0%}
            <a class="btn btn-primary position-relative" href="{% url 'sala_revisar_proyecto' s.id %}">Observación</a>
            {% else %}
            <a href="{% url 'sala_revisar_proyecto' s.id %}" type="button" class="btn btn-primary position-relative">
                Observación
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{no_visto}}
                <span class="visually-hidden">unread messages</span>
            </span>
            </a>
            {% endif %}
            {% comment %}<a class="btn btn-primary" href="{% url 'proyecto_corregido' s.id %}">Corrección</a>{% endcomment %}
        {% endif %}
        </td>      
        </tr>
        {%endfor%}
    </tbody>
    </table>
    </div>
    <br>
{% endif %}


{% comment %}********* PERFIL **************{% endcomment %}
{% if progreso < 64 and not grupo == 'director'%}
    {% if grupo == 'tutor' and not estudiante.vb_perfil_tutor %}
        {% include 'proyecto/revisar_perfil.html'%}
    {% elif grupo == 'docente' and estudiante.vb_perfil_tutor%}
        {% include 'proyecto/revisar_perfil.html'%}
    {% elif grupo == 'tutor' and estudiante.vb_perfil_tutor%}
        <div class="d-inline p-2 bg-danger text-white">El Docente ETN-1040 dará visto bueno al perfil.</div>
    {% endif %}
{% endif %}

    </div>
    {% include 'proyecto/documentos_estudiante.html'%}

</div>

<a class="btn btn-danger" href='/'> Atras</a>

<br>
{% endblock %}

